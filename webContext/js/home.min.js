var locationpath="root",parentpath="null",ap,zipTimer,folderView,originFolderView,fs,ifs,checkedMovefiles,isCopy,repeMap,strMoveOptMap,mRepeSize,constraintLevel,account,isUpLoading=!1,isImporting=!1,isImportingExcel=!1,uploadTargetFolder,isChangingPassword=!1,importFolderName,xhr,viewerPageSize=15,viewer,viewerPageIndex,viewerTotal,pvl,checkFilesTip="提示：您还未选择任何文件，请先选中一些文件后再执行本操作：<br /><br /><kbd>单击</kbd>：选中某一文件<br /><br /><kbd><kbd>Shift</kbd>+<kbd>单击</kbd></kbd>：选中多个文件<br /><br /><kbd><kbd>Shift</kbd>+<kbd>双击</kbd></kbd>：选中连续的文件<br /><br /><kbd><kbd>Shitf</kbd>+<kbd>A</kbd></kbd>：选中/取消选中所有文件",winHeight,pingInt,noticeInited=!1,loadingComplete,totalFoldersOffset,totalFilesOffset,remainingLoadingRequest,loadingFolderView;function updateWinHeight(){window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight)}function changeFilesTableStyle(){$(window).width()<768?($("#filetableheadera").addClass("filetableheaderstyle"),$("#filetableheadera").attr("data-toggle","collapse"),$("#filetableheadera").attr("data-target","#filetableoptmenu"),$("#mdropdownicon").html("（点击展开/折叠菜单）")):($("#filetableheadera").removeClass("filetableheaderstyle"),$("#filetableheadera").attr("data-toggle","modal"),$("#filetableheadera").attr("data-target","#folderInfoModal"),$("#mdropdownicon").html(""))}function doAlert(){alert("错误：无法连接到kiftd服务器，请检查您的网络连接或查看服务器运行状态。")}function getServerOS(){$.ajax({type:"POST",dataType:"text",data:{},url:"homeController/getServerOS.ajax",success:function(e){"mustLogin"!=e?$("#serverOS").text(e):window.location.href="prv/login.html"},error:function(){$("#serverOS").html("<a onclick='getServerOS()'>获取失败，点击重试</a>")}})}function showFolderView(fid,targetId){loadingFolderView||(startLoading(),remainingLoadingRequest&&remainingLoadingRequest.abort(),$.ajax({type:"POST",dataType:"text",data:{fid:fid},url:"homeController/getFolderView.ajax",success:function(result){switch(endLoading(),result){case"ERROR":doAlert(),$("#tb").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#publishTime").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#parentlistbox").html("<span class='graytext'>获取失败，请尝试刷新</span>");break;case"NOT_FOUND":case"notAccess":document.cookie="folder_id="+escape("root");case"mustLogin":window.location.href="/";break;default:folderView=eval("("+result+")"),locationpath=folderView.folder.folderId,document.cookie="folder_id="+escape(locationpath),parentpath=folderView.folder.folderParent,constraintLevel=folderView.folder.folderConstraint,screenedFoldrView=null,originFolderView=$.extend(!0,{},folderView),totalFoldersOffset=folderView.foldersOffset,totalFilesOffset=folderView.filesOffset,$("#sreachKeyWordIn").val(""),showParentList(folderView),showAccountView(folderView),showPublishTime(folderView),$("#sortByFN").removeClass(),$("#sortByCD").removeClass(),$("#sortByFS").removeClass(),$("#sortByCN").removeClass(),$("#sortByOR").removeClass(),showFolderTable(folderView),$("#fim_name").text(folderView.folder.folderName),$("#fim_creator").text(folderView.folder.folderCreatorName),$("#fim_folderCreationDate").text(folderView.folder.folderCreationDate),$("#fim_folderId").text(folderView.folder.folderId),updateTheFolderInfo(),folderView.foldersOffset>folderView.selectStep||folderView.filesOffset>folderView.selectStep?(showLoadingRemaininngBox(),loadingRemainingFolderView(targetId)):(hiddenLoadingRemaininngBox(),doFixedRow(targetId))}},error:function(e,t,o){endLoading(),doAlert(),$("#tb").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#publishTime").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#parentlistbox").html("<span class='graytext'>获取失败，请尝试刷新</span>")}}))}function startLoading(){loadingFolderView=!0,$("#loadingModal").modal({backdrop:"static",keyboard:!1}),$("#loadingModal").modal("show"),$("#loadingModal").addClass("shown")}function endLoading(){loadingFolderView=!1,$("#loadingModal").modal("hide"),$("#loadingModal").removeClass("shown")}function startLogin(){$("#accountid").attr("disabled","disabled"),$("#accountpwd").attr("disabled","disabled"),$("#dologinButton").attr("disabled","disabled"),$("#vercode").attr("disabled","disabled")}function finishLogin(){$("#accountid").removeAttr("disabled"),$("#accountpwd").removeAttr("disabled"),$("#dologinButton").removeAttr("disabled"),$("#vercode").removeAttr("disabled")}function dologin(){var accountId=$("#accountid").val(),accountPwd=$("#accountpwd").val(),check="y";0==accountId.length?($("#accountidbox").addClass("has-error"),check="n"):$("#accountidbox").removeClass("has-error"),0==accountPwd.length?($("#accountpwdbox").addClass("has-error"),check="n"):$("#accountpwdbox").removeClass("has-error"),"y"==check&&(startLogin(),$.ajax({url:"homeController/getPublicKey.ajax",type:"POST",data:{},dataType:"text",success:function(result){var publicKeyInfo=eval("("+result+")"),date=new Date,loginInfo='{accountId:"'+accountId+'",accountPwd:"'+accountPwd+'",time:"'+publicKeyInfo.time+'"}',encrypt=new JSEncrypt;encrypt.setPublicKey(publicKeyInfo.publicKey);var encrypted=encrypt.encrypt(loginInfo);sendLoginInfo(encrypted)},error:function(){finishLogin(),$("#alertbox").addClass("alert"),$("#alertbox").addClass("alert-danger"),$("#alertbox").text("提示：登录请求失败，请检查网络或服务器运行状态")}}))}function sendLoginInfo(e){$.ajax({type:"POST",dataType:"text",url:"homeController/doLogin.ajax",data:{encrypted:e,vercode:$("#vercode").val()},success:function(e){switch(finishLogin(),$("#alertbox").removeClass("alert"),$("#alertbox").removeClass("alert-danger"),$("#alertbox").text(""),$("#vercodebox").html(""),$("#vercodebox").removeClass("show"),$("#vercodebox").addClass("hidden"),e){case"permitlogin":$("#accountidbox").removeClass("has-error"),$("#accountpwdbox").removeClass("has-error"),$("#loginModal").modal("hide"),showFolderView(locationpath);break;case"accountnotfound":$("#accountidbox").addClass("has-error"),$("#accountpwdbox").removeClass("has-error"),$("#alertbox").addClass("alert"),$("#alertbox").addClass("alert-danger"),$("#alertbox").text("提示：登录失败，账户不存在或未设置");break;case"accountpwderror":$("#accountpwdbox").addClass("has-error"),$("#accountidbox").removeClass("has-error"),$("#alertbox").addClass("alert"),$("#alertbox").addClass("alert-danger"),$("#alertbox").text("提示：登录失败，密码错误或未设置");break;case"needsubmitvercode":$("#vercodebox").html("<label id='vercodetitle' class='col-sm-7'><img id='showvercode' class='vercodeimg' alt='点击获取验证码' src='homeController/getNewVerCode.do?s="+(new Date).getTime()+"' onclick='getNewVerCode()'></label><div class='col-sm-5'><input type='text' class='form-control' id='vercode' placeholder='验证码……'></div>"),$("#vercodebox").removeClass("hidden"),$("#vercodebox").addClass("show");break;case"error":$("#alertbox").addClass("alert"),$("#alertbox").addClass("alert-danger"),$("#alertbox").text("提示：登录失败，登录请求无法通过加密效验（可能是请求耗时过长导致的）");break;default:$("#alertbox").addClass("alert"),$("#alertbox").addClass("alert-danger"),$("#alertbox").text("提示：无法登录，未知错误")}},error:function(){finishLogin(),$("#alertbox").addClass("alert"),$("#alertbox").addClass("alert-danger"),$("#alertbox").text("提示：登录请求失败，请检查网络或服务器运行状态")}})}function getNewVerCode(){$("#showvercode").attr("src","homeController/getNewVerCode.do?s="+(new Date).getTime())}function dologout(){$("#logoutModal").modal("hide"),$.ajax({url:"homeController/doLogout.ajax",type:"POST",data:{},dataType:"text",success:function(e){"SUCCESS"==e&&showFolderView(locationpath)},error:function(){doAlert()}})}function showParentList(e){$("#parentFolderList").html("");var t=e.folder;e.parentList.length>0?$.each(e.parentList,function(e,t){$("#parentFolderList").append("<li><a href='javascript:void(0);' onclick='entryFolder(\""+t.folderId+"\")'>"+t.folderName+"</a></li>")}):$("#parentFolderList").html("<li class='disabled'><a>无</a></li>"),t.folderName.length>6?$("#currentFolderName").text(t.folderName.substr(0,6)+"..."):$("#currentFolderName").text(t.folderName),"ROOT"==t.folderName?($("#folderIconSpan").removeClass("glyphicon-folder-close"),$("#folderIconSpan").removeClass("glyphicon-search"),$("#folderIconSpan").addClass("glyphicon-home")):null!=e.keyWorld?($("#folderIconSpan").removeClass("glyphicon-folder-close"),$("#folderIconSpan").removeClass("glyphicon-home"),$("#folderIconSpan").addClass("glyphicon-search")):($("#folderIconSpan").removeClass("glyphicon-home"),$("#folderIconSpan").removeClass("glyphicon-search"),$("#folderIconSpan").addClass("glyphicon-folder-close"))}function showAccountView(e){$("#tb,#tb2").html(""),account=e.account,null!=e.account?($("#tb").append("<button class='btn btn-link rightbtn hidden-xs' data-toggle='modal' data-target='#logoutModal'>注销 ["+e.account+"] <span class='glyphicon glyphicon-off' aria-hidden='true'></span></button>"),$("#tb2").append("<button class='btn btn-link' data-toggle='modal' data-target='#logoutModal'>注销 ["+e.account+"] <span class='glyphicon glyphicon-off' aria-hidden='true'></span></button>"),"true"==e.allowChangePassword&&($("#tb").append(" <button class='btn btn-link rightbtn hidden-xs' data-toggle='modal' data-target='#changePasswordModal'>修改密码 <span class='glyphicon glyphicon-edit' aria-hidden='true'></span></button>"),$("#tb2").append(" <button class='btn btn-link' data-toggle='modal' data-target='#changePasswordModal'>修改密码 <span class='glyphicon glyphicon-edit' aria-hidden='true'></span></button>"))):($("#tb").append("<button class='btn btn-link rightbtn hidden-xs' data-toggle='modal' data-target='#loginModal'>登入 <span class='glyphicon glyphicon-user' aria-hidden='true'></span></button>"),$("#tb2").append("<button class='btn btn-link' data-toggle='modal' data-target='#loginModal'>登入 <span class='glyphicon glyphicon-user' aria-hidden='true'></span></button>"),"true"==e.allowSignUp&&($("#tb").append(" <button class='btn btn-link rightbtn hidden-xs' onclick='window.location.href = \"/prv/signup.html\"'>立即注册 <span class='glyphicon glyphicon-log-in' aria-hidden='true'></span></button>"),$("#tb2").append(" <button class='btn btn-link' onclick='window.location.href = \"prv/signup.html\"'>立即注册 <span class='glyphicon glyphicon-log-in' aria-hidden='true'></span></button>")));var t=e.authList;$("#fileListDropDown li").addClass("disabled"),$("#fileListDropDown li a").attr("onclick",""),null!=t&&(checkAuth(t,"C")&&($("#createFolderButtonLi").removeClass("disabled"),$("#createFolderButtonLi a").attr("onclick","showNewFolderModel()")),checkAuth(t,"U")&&($("#uploadFileButtonLi").removeClass("disabled"),$("#uploadFileButtonLi a").attr("onclick","showUploadFileModel()"),checkAuth(t,"C")&&isSupportWebkitdirectory()&&($("#uploadFolderButtonLi").removeClass("disabled"),$("#uploadFolderButtonLi a").attr("onclick","showUploadFolderModel()"))),e.enableDownloadZip&&checkAuth(t,"L")?$("#packageDownloadBox").html("<button class='btn btn-link navbar-btn' onclick='showDownloadAllCheckedModel()'><span class='glyphicon glyphicon-briefcase'></span> 打包下载</button>"):$("#packageDownloadBox").html(""),checkAuth(t,"D")&&($("#deleteSeelectFileButtonLi").removeClass("disabled"),$("#deleteSeelectFileButtonLi a").attr("onclick","showDeleteAllCheckedModel()")),checkAuth(t,"P")&&($("#importAccountExcelButtonLi").removeClass("hide"),$("#importAccountExcelButtonLi").removeClass("disabled"),$("#importAccountExcelButtonLi a").attr("onclick","showImportAccountExcelModel()")),checkAuth(t,"M")&&($("#cutFileButtonLi").removeClass("disabled"),$("#stickFileButtonLi").removeClass("disabled"),$("#copyFileButtonLi").removeClass("disabled"),$("#cutFileButtonLi a").attr("onclick","cutFile()"),$("#copyFileButtonLi a").attr("onclick","copyFile()"),$("#stickFileButtonLi a").attr("onclick","stickFile()"),void 0!==checkedMovefiles&&checkedMovefiles.size>0?(checkedMovefiles.size<100?$("#stickFilesCount").text("（"+checkedMovefiles.size+"）"):$("#stickFilesCount").text("（99+）"),$("#copyFileButtonLi").removeClass("show"),$("#copyFileButtonLi").addClass("hidden"),$("#cutFileButtonLi").removeClass("show"),$("#cutFileButtonLi").addClass("hidden"),$("#stickFileButtonLi").removeClass("hidden"),$("#stickFileButtonLi").addClass("show")):($("#copyFileButtonLi").removeClass("hidden"),$("#copyFileButtonLi").addClass("show"),$("#cutFileButtonLi").removeClass("hidden"),$("#cutFileButtonLi").addClass("show"),$("#stickFileButtonLi").removeClass("show"),$("#stickFileButtonLi").addClass("hidden"),$("#stickFilesCount").text(""))))}function checkAuth(e,t){var o=!1;return $.each(e,function(e,l){l==t&&(o=!0)}),o}function showPublishTime(e){$("#publishTime").html("");var t="";t=null!=e.publishTime?e.publishTime:"--",$("#publishTime").text(t)}function refreshFolderView(){null!=locationpath&&locationpath.length>0?showFolderView(locationpath):showFolderView("root"),subscribeNotice()}function returnPF(){showFolderView(null!=parentpath&&"null"!=parentpath?parentpath:"root")}function showFolderTable(e){$("#foldertable").html(""),null!=parentpath&&"null"!=parentpath&&$("#foldertable").append("<tr onclick='returnPF()'><td><button onclick='' class='btn btn-link btn-xs'>返回</button></td><td class='hidden-xs'>--</td><td>--</td><td class='hidden-xs'>--</td><td>--</td></tr>");var t=e.authList,o=!1,l=!1,a=!1,r=!1;checkAuth(t,"D")&&(o=!0),checkAuth(t,"R")&&(l=!0),checkAuth(t,"L")&&(a=!0),checkAuth(t,"O")&&(r=!0);for(var i=e.folderList.length;i>0;i--){var n=e.folderList[i-1];$("#foldertable").append(createNewFolderRow(n,o,l,r))}for(var d=e.fileList.length;d>0;d--){var s=e.fileList[d-1];$("#foldertable").append(createFileRow(s,a,o,l,r))}}function createFileRow(e,t,o,l,a){e.fileName=html2Escape(e.fileName);var r="<tr id="+e.fileId+" onclick='checkfile(event,\""+e.fileId+"\")' ondblclick='checkConsFile(event,\""+e.fileId+"\")' id='"+e.fileId+"' class='filerow'><td>"+e.fileName+"</td><td class='hidden-xs'>"+e.fileCreationDate+"</td>";if("0"==e.fileSize?r+="<td>&lt;1MB</td>":r=r+"<td>"+e.fileSize+"MB</td>",r=r+"<td class='hidden-xs'>"+e.fileCreatorName+"</td><td>",t)switch(r=r+"<button onclick='showDownloadModel(\""+e.fileId+'","'+replaceAllQuotationMarks(e.fileName)+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-cloud-download'></span> 下载</button>",getSuffix(e.fileName)){case"mp4":r=r+"<button onclick='playVideo(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-play'></span> 播放</button>";break;case"webm":case"mov":case"avi":case"wmv":case"mkv":case"flv":folderView.enableFFMPEG&&(r=r+"<button onclick='playVideo(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-play'></span> 播放</button>");break;case"pdf":r=r+"<button onclick='pdfView(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-eye-open'></span> 预览</button>";break;case"jpg":case"jpeg":case"gif":case"png":case"bmp":r=r+"<button onclick='showPicture(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-picture'></span> 查看</button>";break;case"mp3":case"wav":case"ogg":r=r+"<button onclick='playAudio(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-play'></span> 播放</button>";break;case"docx":r=r+"<button onclick='docxView(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-eye-open'></span> 预览</button>";break;case"txt":r=r+"<button onclick='txtView(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-eye-open'></span> 预览</button>";break;case"ppt":case"pptx":r=r+"<button onclick='pptView(\""+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-eye-open'></span> 预览</button>"}return o&&(r=r+"<button onclick='showDeleteFileModel(\""+e.fileId+'","'+replaceAllQuotationMarks(e.fileName)+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-remove'></span> 删除</button>"),l&&(r=r+"<button onclick='showRenameFileModel(\""+e.fileId+'","'+replaceAllQuotationMarks(e.fileName)+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-wrench'></span> 重命名</button>"),a&&(r=r+"<button onclick='showFolderView(\""+e.fileParentFolder+'","'+e.fileId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-sunglasses'></span> 定位</button>"),t&&"true"==folderView.showFileChain&&(r=r+"<button onclick='getFileChain(\""+e.fileId+'","'+replaceAllQuotationMarks(e.fileName)+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-link'></span> 链接</button>"),l||o||t||a||(r+="--"),r+="</td></tr>"}function createNewFolderRow(e,t,o,l){e.folderName=html2Escape(e.folderName);var a="<tr id='"+e.folderId+"' onclick='checkfile(event,\""+e.folderId+"\")' ondblclick='checkConsFile(event,\""+e.folderId+"\")' class='filerow' iskfolder='true' ><td><button onclick='entryFolder(\""+e.folderId+"\")' class='btn btn-link btn-xs'>/"+e.folderName+"</button></td><td class='hidden-xs'>"+e.folderCreationDate+"</td><td>--</td><td class='hidden-xs'>"+e.folderCreatorName+"</td><td>";return t&&(a=a+"<button onclick='showDeleteFolderModel(\""+e.folderId+'","'+replaceAllQuotationMarks(e.folderName)+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-remove'></span> 删除</button>"),o&&(a=a+"<button onclick='showRenameFolderModel(\""+e.folderId+'","'+replaceAllQuotationMarks(e.folderName)+'",'+e.folderConstraint+")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-wrench'></span> 编辑</button>"),l&&(a=a+"<button onclick='showFolderView(\""+e.folderParent+'","'+e.folderId+"\")' class='btn btn-link btn-xs'><span class='glyphicon glyphicon-sunglasses'></span> 定位</button>"),o||t||l||(a+="--"),a+="</td></tr>"}$(function(){window.onresize=function(){changeFilesTableStyle(),updateWinHeight()},changeFilesTableStyle(),getServerOS(),subscribeNotice();var e=document.cookie.match(new RegExp("(^| )folder_id=([^;]*)(;|$)"));showFolderView(null!=e?unescape(e[2]):"root"),$(document).click(function(e){var t=$("#filetable")[0],o=e.srcElement;o||(o=e.target),o===t||$.contains(t,e.target)||$(".filerow").removeClass("info")}),$("#audioPlayerModal").on("hidden.bs.modal",function(e){null!=ap&&(ap.seek(0),ap.pause()),null!=pingInt&&(window.clearInterval(pingInt),pingInt=null)}),$("#downloadAllCheckedModal").on("hidden.bs.modal",function(e){null!=zipTimer&&window.clearInterval(zipTimer)}),$("#loginModal").on("hidden.bs.modal",function(e){"disabled"!==$("#dologinButton").attr("disabled")&&($("#accountid").val(""),$("#accountpwd").val("")),$("#accountidbox").removeClass("has-error"),$("#accountpwdbox").removeClass("has-error"),$("#alertbox").removeClass("alert"),$("#alertbox").removeClass("alert-danger"),$("#alertbox").text(""),$("#vercodebox").html(""),$("#vercodebox").removeClass("show"),$("#vercodebox").addClass("hidden")}),$(".modal").on("shown.bs.modal",function(e){$(this).addClass("shown")}),$(".modal").on("hidden.bs.modal",function(e){$(this).removeClass("shown")}),$("body").keypress(function(e){if(13==(e.keyCode?e.keyCode:e.which?e.which:e.charCode)){if("sreachKeyWordIn"===document.activeElement.id)doSearchFile();else{var t=$(".shown .btn-primary");null!=t.get(0)&&0==t.prop("disabled")&&t.click()}return!1}}),$("#loginModal").on("shown.bs.modal",function(e){$("#accountid").focus()}),$("#newFolderModal").on("show.bs.modal",function(e){if($("#folderalert").removeClass("alert"),$("#folderalert").removeClass("alert-danger"),$("#foldernamebox").removeClass("has-error"),$("#folderalert").text(""),$("#foldername").val(""),$("#foldertypelist").html(""),null!=account){$("#foldername").attr("folderConstraintLevel",constraintLevel+""),$("#newfoldertype").text(folderTypes[constraintLevel]);for(var t=constraintLevel;t<folderTypes.length;t++)$("#foldertypelist").append("<li><a onclick='changeNewFolderType("+t+")'>"+folderTypes[t]+"</a></li>")}else $("#foldertypelist").append("<li><a onclick='changeNewFolderType(0)'>"+folderTypes[0]+"</a></li>")}),$("#newFolderModal").on("shown.bs.modal",function(e){$("#foldername").focus()}),$("#uploadFileModal,#importFolderModal").on("hidden.bs.modal",function(e){if(isUpLoading||isImporting){$("#operationMenuBox").attr("data-placement","top"),$("#operationMenuBox").attr("data-trigger","focus"),$("#operationMenuBox").attr("data-title","上传中"),$("#operationMenuBox").attr("data-content","您可以重新打开上传窗口查看上传进度。"),$("#operationMenuBox").popover(),$("#operationMenuBox").popover("show");setTimeout(function(){$("#operationMenuBox").attr("data-title",""),$("#operationMenuBox").attr("data-content",""),$("#operationMenuBox").popover("destroy")},2e3)}}),$("#renameFolderModal").on("show.bs.modal",function(e){if($("#editfolderalert").removeClass("alert"),$("#editfolderalert").removeClass("alert-danger"),$("#folderrenamebox").removeClass("has-error"),$("#editfolderalert").text(""),$("#editfoldertypelist").html(""),null!=account)for(var t=constraintLevel;t<folderTypes.length;t++)$("#editfoldertypelist").append("<li><a onclick='changeEditFolderType("+t+")'>"+folderTypes[t]+"</a></li>");else $("#editfoldertypelist").append("<li><a onclick='changeEditFolderType(0)'>"+folderTypes[0]+"</a></li>")}),document.ondragover=function(e){e.preventDefault?(e.preventDefault(),e.stopPropagation()):(window.event.cancelBubble=!0,window.event.returnValue=!1)},document.ondrop=function(e){if(e.preventDefault?(e.preventDefault(),e.stopPropagation()):(window.event.cancelBubble=!0,window.event.returnValue=!1),null!=folderView.authList)if(checkAuth(folderView.authList,"U"))if(isUpLoading||isImporting)alert("提示：您正在执行另一项上传任务，请在上传完成后再试。");else if(window.ActiveXObject||"ActiveXObject"in window)alert("提示：IE浏览器不支持拖拽上传。您可以使用现代浏览器或将浏览模式切换为“极速模式”来体验该功能。");else{var t;t=null!=e.dataTransfer?e.dataTransfer:window.event.dataTransfer;var o=!0;if(void 0!==t.items)for(var l=0;l<t.items.length;l++){var a=t.items[l];"file"===a.kind&&a.webkitGetAsEntry().isFile||(o=!1)}else for(l=0;l<t.files.length;l++){var r=df.files[l];if(r.type);else try{var i=new FileReader;i.readAsDataURL(r.slice(0,10)),i.addEventListener("load",function(e){},!1),i.addEventListener("error",function(e){o=!1},!1)}catch(e){o=!1}}o?(fs=e.dataTransfer.files,showUploadFileModel(),showfilepath(),checkUploadFile()):alert("提示：您拖入的文件中包含了一个或多个文件夹，无法进行上传。")}else alert("提示：您不具备上传权限，无法上传文件。");else alert("提示：您不具备上传权限，无法上传文件。")},$(document).keypress(function(e){if(0==$(".modal.shown").length||1==$(".modal.shown").length&&"loadingModal"==$(".modal.shown").attr("id")){var t=e.keyCode?e.keyCode:e.which?e.which:e.charCode;if(isShift(e)&&"sreachKeyWordIn"!=document.activeElement.id){switch(t){case 65:checkallfile();break;case 78:$("#createFolderButtonLi a").click();break;case 85:$("#uploadFileButtonLi a").click();break;case 68:$("#deleteSeelectFileButtonLi a").click();break;case 70:$("#uploadFolderButtonLi a").click();break;case 67:null!=checkedMovefiles&&0!=checkedMovefiles.size||$("#copyFileButtonLi a").click();break;case 88:null!=checkedMovefiles&&0!=checkedMovefiles.size||$("#cutFileButtonLi a").click();break;case 86:void 0!==checkedMovefiles&&checkedMovefiles.size>0&&$("#stickFileButtonLi a").click();break;default:return!0}return!1}}}),$("#moveFilesModal").on("hidden.bs.modal",function(e){checkedMovefiles=void 0,$("#copyFileButtonLi").removeClass("hidden"),$("#copyFileButtonLi").addClass("show"),$("#cutFileButtonLi").removeClass("hidden"),$("#cutFileButtonLi").addClass("show"),$("#stickFileButtonLi").removeClass("show"),$("#stickFileButtonLi").addClass("hidden"),$("#stickFilesCount").text(""),$("#moveFilesBox").html("")}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),$("#downloadModal").on("hidden.bs.modal",function(e){$("#downloadURLCollapse").collapse("hide")}),updateWinHeight(),$(window).scroll(function(){$(this).scrollTop()>2*winHeight?$("#gobacktotopbox").removeClass("hidden"):$("#gobacktotopbox").addClass("hidden")}),$("#downloadURLCollapse").on("shown.bs.collapse",function(){getDownloadURL()}),$("#changePasswordModal").on("show.bs.modal",function(e){isChangingPassword||($("#changepassword_oldpwd,#changepassword_newpwd,#changepassword_reqnewpwd,#changePasswordButton,#changepassword_vercode").attr("disabled",!1),$("#changepassword_oldepwdbox,#changepassword_newpwdbox,#changepassword_reqnewpwdbox").removeClass("has-error"),$("#changepassword_oldpwd,#changepassword_newpwd,#changepassword_reqnewpwd").val(""),$("#changepasswordalertbox,#changepassword_vccodebox").hide())}),$("#changePasswordModal").on("shown.bs.modal",function(e){isChangingPassword||$("#changepassword_oldpwd").focus()}),$("#noticeModal").on("show.bs.modal",function(e){document.cookie.match(new RegExp("(^| )notice_md5_30=([^;]*)(;|$)"))?$("#dontShowSomeNoticeAt30Day").attr("checked","checked"):$("#dontShowSomeNoticeAt30Day").attr("checked",!1)}),$("#noticeModal").on("hidden.bs.modal",function(e){var t=new Date;if($("#dontShowSomeNoticeAt30Day").prop("checked")){t.setTime(t.getTime()+2592e6);var o=document.cookie.match(new RegExp("(^| )notice_md5=([^;]*)(;|$)"));o?document.cookie="notice_md5_30="+escape(unescape(o[2]))+";expires="+t.toUTCString():(o=document.cookie.match(new RegExp("(^| )notice_md5_30=([^;]*)(;|$)")))&&(document.cookie="notice_md5_30="+escape(unescape(o[2]))+";expires="+t.toUTCString())}else{t.setTime(0),document.cookie.match(new RegExp("(^| )notice_md5_30=([^;]*)(;|$)"))&&(document.cookie="notice_md5_30=0;expires="+t.toUTCString())}})});var folderTypes=["公开的","仅小组","仅创建者"],repeList,repeIndex,repeModelList,screenedFoldrView,getDownloadFileId,getDownloadFileName;function showNewFolderModel(){$("#newFolderModal").modal("show")}function changeNewFolderType(e){$("#newfoldertype").text(folderTypes[e]),$("#foldername").attr("folderConstraintLevel",e+"")}function createfolder(){var e=$("#foldername").val(),t=$("#foldername").attr("folderConstraintLevel"),o=new RegExp('[/|\\\\*\\<\\>\\?\\:\\&\\$"]+',"g");0==e.length?showFolderAlert("提示：文件夹名称不能为空。"):e.length>128?showFolderAlert("提示：文件夹名称太长。"):o.test(e)||0==e.indexOf(".")?showFolderAlert("提示：文件夹名中不应含有：引号 / \\ * | < > & $ : ? 且不能以“.”开头。"):($("#folderalert").removeClass("alert"),$("#folderalert").removeClass("alert-danger"),$("#foldernamebox").removeClass("has-error"),$("#folderalert").text(""),$.ajax({type:"POST",dataType:"text",data:{parentId:locationpath,folderName:e,folderConstraint:t},url:"homeController/newFolder.ajax",success:function(e){if("mustLogin"==e)window.location.href="prv/login.html";else switch(e){case"noAuthorized":showFolderAlert("提示：您的操作未被授权，创建文件夹失败。");break;case"errorParameter":showFolderAlert("提示：参数不正确，创建文件夹失败。");break;case"cannotCreateFolder":showFolderAlert("提示：出现意外错误，可能未能创建文件夹。");break;case"nameOccupied":showFolderAlert("提示：该名称已被占用，请选取其他名称。");break;case"foldersTotalOutOfLimit":showFolderAlert("提示：该文件夹内存储的文件夹数量已达上限，无法在其中创建更多文件夹。");break;case"createFolderSuccess":$("#newFolderModal").modal("hide"),showFolderView(locationpath);break;default:showFolderAlert("提示：出现意外错误，可能未能创建文件夹。")}},error:function(){showFolderAlert("提示：出现意外错误，可能未能创建文件夹")}}))}function showFolderAlert(e){$("#folderalert").addClass("alert"),$("#folderalert").addClass("alert-danger"),$("#foldernamebox").addClass("has-error"),$("#folderalert").text(e)}function entryFolder(e){showFolderView(e)}function showDeleteFolderModel(e,t){$("#deleteFolderBox").html("<button id='dmbutton' type='button' class='btn btn-danger' onclick='deleteFolder(\""+e+"\")'>删除</button>"),$("#dmbutton").attr("disabled",!1),$("#cancelDeleteFolderBtn").attr("disabled",!1),$("#deleteFolderMessage").text("提示：确定要彻底删除文件夹：["+t+"]及其全部内容么？该操作不可恢复"),$("#deleteFolderModal").modal("toggle")}function deleteFolder(e){$("#dmbutton").attr("disabled",!0),$("#cancelDeleteFolderBtn").attr("disabled",!0),$("#deleteFolderMessage").text("提示：正在删除，请稍候..."),$.ajax({type:"POST",dataType:"text",data:{folderId:e},url:"homeController/deleteFolder.ajax",success:function(e){"mustLogin"==e?window.location.href="prv/login.html":"noAuthorized"==e?($("#deleteFolderMessage").text("提示：您的操作未被授权，删除文件夹失败"),$("#dmbutton").attr("disabled",!1),$("#cancelDeleteFolderBtn").attr("disabled",!0)):"errorParameter"==e?($("#deleteFolderMessage").text("提示：参数不正确，删除文件夹失败"),$("#dmbutton").attr("disabled",!1),$("#cancelDeleteFolderBtn").attr("disabled",!0)):"cannotDeleteFolder"==e?($("#deleteFolderMessage").text("提示：出现意外错误，可能未能删除文件夹"),$("#dmbutton").attr("disabled",!1),$("#cancelDeleteFolderBtn").attr("disabled",!0)):"deleteFolderSuccess"==e?($("#deleteFolderModal").modal("hide"),showFolderView(locationpath)):($("#deleteFolderMessage").text("提示：出现意外错误，可能未能删除文件夹"),$("#dmbutton").attr("disabled",!1),$("#cancelDeleteFolderBtn").attr("disabled",!0))},error:function(){$("#deleteFolderMessage").text("提示：出现意外错误，可能未能删除文件夹"),$("#dmbutton").attr("disabled",!1),$("#cancelDeleteFolderBtn").attr("disabled",!0)}})}function showRenameFolderModel(e,t,o){$("#renameFolderBox").html("<button type='button' class='btn btn-primary' onclick='renameFolder(\""+e+"\")'>修改</button>"),$("#newfoldername").val(t),changeEditFolderType(o),$("#renameFolderModal").modal("show")}function changeEditFolderType(e){$("#editfoldertype").text(folderTypes[e]),$("#newfoldername").attr("folderConstraintLevel",e+"")}function renameFolder(e){var t=$("#newfoldername").val(),o=$("#newfoldername").attr("folderConstraintLevel"),l=new RegExp('[/|\\\\*\\<\\>\\?\\:\\&\\$"]+',"g");0==t.length?showRFolderAlert("提示：文件夹名称不能为空。"):t.length>128?showRFolderAlert("提示：文件夹名称太长。"):l.test(t)||0==t.indexOf(".")?showRFolderAlert("提示：文件夹名中不应含有：引号 / \\ * | < > & $ : ? 且不能以“.”开头。"):($("#newfolderalert").removeClass("alert"),$("#newfolderalert").removeClass("alert-danger"),$("#folderrenamebox").removeClass("has-error"),$("#newfolderalert").text(""),$.ajax({type:"POST",dataType:"text",data:{folderId:e,newName:t,folderConstraint:o},url:"homeController/renameFolder.ajax",success:function(e){"mustLogin"==e?window.location.href="prv/login.html":"noAuthorized"==e?showRFolderAlert("提示：您的操作未被授权，编辑失败。"):"errorParameter"==e?showRFolderAlert("提示：参数不正确，编辑失败，请刷新后重试。"):"nameOccupied"==e?showRFolderAlert("提示：该名称已被占用，请选取其他名称。"):"renameFolderSuccess"==e?($("#renameFolderModal").modal("hide"),showFolderView(locationpath)):showRFolderAlert("提示：出现意外错误，可能未能编辑文件夹，请刷新后重试。")},error:function(){showRFolderAlert("提示：出现意外错误，可能未能编辑文件夹，请刷新后重试。")}}))}function showRFolderAlert(e){$("#editfolderalert").addClass("alert"),$("#editfolderalert").addClass("alert-danger"),$("#folderrenamebox").addClass("has-error"),$("#editfolderalert").text(e)}function showUploadFileModel(){$("#uploadFileAlert").hide(),$("#uploadFileAlert").text(""),0==isUpLoading&&($("#filepath").removeAttr("disabled"),$("#uploadfile").val(""),$("#filepath").val(""),$("#pros").width("0%"),$("#pros").attr("aria-valuenow","0"),$("#umbutton").attr("disabled",!1),$("#filecount").text(""),$("#uploadstatus").html(""),$("#selectcount").text(""),$("#selectFileUpLoadModelAsAll").removeAttr("checked"),$("#selectFileUpLoadModelAlert").hide()),$("#uploadFileModal").modal("show")}function checkpath(){$("#uploadfile").click()}function getInputUpload(){fs=$("#uploadfile").get(0).files,showfilepath()}function getImport(){fs=$("#importFile").get(0).files,showImportFilepath()}function checkImportPath(){$("#importFile").click()}function abortImportExcel(){null!=xhr&&xhr.abort(),$("#importAccountExcelModal").modal("hide")}function checkImportExcelFile(){if(0==isImportingExcel)if(null!=fs&&fs.length>0){$("#importExcelFilepath").attr("disabled","disabled"),$("#ipbutton").attr("disabled",!0),isUpLoading=!0,repeModelList=null;for(var e=new Array,t=0,o=0;o<fs.length;o++)e[o]=fs[o].name,fs[o].size>t&&(t=fs[o].size,o);var l=JSON.stringify(e),a=fs[0],r=a.name;uploadTargetFolder=locationpath;var i=new FormData;i.append("file",a),i.append("fname",r),i.append("folderId",uploadTargetFolder),i.append("namelist",l),$.ajax({type:"POST",dataType:"text",data:i,url:"homeController/checkImportFile.ajax",processData:!1,contentType:!1,cache:!1,success:function(e){if("mustLogin"==e)window.location.href="prv/login.html";else switch(e){case"errorParameter":showImportExcelAlert("提示：参数不正确，无法开始上传");break;case"noAuthorized":showImportExcelAlert("提示：您的操作未被授权，无法开始上传");break;case"errorEmpty":showImportExcelAlert("提示：文件类型为空，不能导入");break;case"errorContentType":showImportExcelAlert("提示：导入文本类型不正确，必须要为.xlsx, .xls类型的");break;case"uploaderror":showImportExcelAlert("提示：出现意外错误，无法开始导入");break;case"uploadsuccess":$("#importAccountExcelModal").modal("hide")}},error:function(){showImportExcelAlert("提示：出现意外错误，无法开始导入")}})}else showImportExcelAlert("提示：您未选择任何文件，无法开始导入");else showImportExcelAlert("提示：另一项上传文件或文件夹的任务尚未完成，无法开始导入")}function showImportExcelAlert(e){isUpLoading=!1,$("#importExcelAlert").addClass("alert"),$("#importExcelAlert").addClass("alert-danger"),$("#importExcelFilepath").removeAttr("disabled"),$("#importExcelAlert").show(),$("#importExcelAlert").text(e),$("#ipbutton").attr("disabled",!1)}function showImportFilepath(){for(var e="",t=0;t<fs.length;t++)e+=fs[t].name,t<fs.length-1&&(e+="、");fs.length<=1?$("#selectExcelCount").text(""):$("#selectExcelCount").text("（共"+fs.length+"个）"),$("#importExcelFilepath").val(e)}function showfilepath(){for(var e="",t=0;t<fs.length;t++)e+=fs[t].name,t<fs.length-1&&(e+="、");fs.length<=1?$("#selectcount").text(""):$("#selectcount").text("（共"+fs.length+"个）"),$("#filepath").val(e)}function checkUploadFile(){if(0==isUpLoading&&0==isImporting)if(null!=fs&&fs.length>0){$("#filepath").attr("disabled","disabled"),$("#umbutton").attr("disabled",!0),isUpLoading=!0,repeModelList=null,$("#uploadFileAlert").hide(),$("#uploadFileAlert").text("");for(var filenames=new Array,maxSize=0,maxFileIndex=0,i=0;i<fs.length;i++)filenames[i]=fs[i].name,fs[i].size>maxSize&&(maxSize=fs[i].size,maxFileIndex=i);var namelist=JSON.stringify(filenames);uploadTargetFolder=locationpath,$.ajax({type:"POST",dataType:"text",data:{folderId:uploadTargetFolder,namelist:namelist,maxSize:maxSize,maxFileIndex:maxFileIndex},url:"homeController/checkUploadFile.ajax",success:function(result){if("mustLogin"==result)window.location.href="prv/login.html";else switch(result){case"errorParameter":showUploadFileAlert("提示：参数不正确，无法开始上传");break;case"noAuthorized":showUploadFileAlert("提示：您的操作未被授权，无法开始上传");break;case"filesTotalOutOfLimit":showUploadFileAlert("提示：该文件夹内存储的文件数量已达上限，无法在其中上传更多文件。您可以尝试将其上传至其他文件夹内。");break;default:var resp=eval("("+result+")");"fileTooLarge"==resp.checkResult?showUploadFileAlert("提示：文件["+resp.overSizeFile+"]的体积超过最大限制（"+resp.maxUploadFileSize+"），无法开始上传"):"hasExistsNames"==resp.checkResult?(repeList=resp.pereFileNameList,repeIndex=0,selectFileUpLoadModelStart()):"permitUpload"==resp.checkResult?doupload(1):showUploadFileAlert("提示：出现意外错误，无法开始上传")}},error:function(){showUploadFileAlert("提示：出现意外错误，无法开始上传")}})}else showUploadFileAlert("提示：您未选择任何文件，无法开始上传");else showUploadFileAlert("提示：另一项上传文件或文件夹的任务尚未完成，无法开始上传")}function selectFileUpLoadModelStart(){checkAuth(originFolderView.authList,"D")?$("#uploadcoverbtn").show():$("#uploadcoverbtn").hide(),$("#selectFileUpLoadModelAlert").show(),$("#repeFileName").text(repeList[repeIndex])}function selectFileUpLoadModelEnd(e){if(null==repeModelList&&(repeModelList={}),repeModelList[$("#repeFileName").text()]=e,$("#selectFileUpLoadModelAlert").hide(),$("#selectFileUpLoadModelAsAll").prop("checked")){for(var t=repeIndex;t<repeList.length;t++)repeModelList[repeList[t]]=e;doupload(1)}else++repeIndex<repeList.length?selectFileUpLoadModelStart():doupload(1)}function doupload(e){var t=fs.length;$("#pros").width("0%"),$("#pros").attr("aria-valuenow","0");var o=fs[e-1];if(null!=o){var l=o.name;t>1&&$("#filecount").text("（"+e+"/"+t+"）"),$("#uploadstatus").prepend("<p>"+html2Escape(l)+"<span id='uls_"+e+"'>[正在上传...]</span></p>"),xhr=new XMLHttpRequest;var a=new FormData;if(a.append("file",o),a.append("fname",l),a.append("folderId",uploadTargetFolder),null!=repeModelList&&null!=repeModelList[l]){if("skip"==repeModelList[l])return $("#uls_"+e).text("[已完成]"),e<t?void doupload(e+1):(isUpLoading=!1,$("#filepath").removeAttr("disabled"),$("#uploadfile").val(""),$("#filepath").val(""),$("#pros").width("0%"),$("#pros").attr("aria-valuenow","0"),$("#umbutton").attr("disabled",!1),$("#filecount").text(""),$("#uploadstatus").text(""),$("#selectcount").text(""),$("#uploadFileModal").modal("hide"),void showFolderView(locationpath));a.append("repeType",repeModelList[l])}xhr.open("POST","homeController/douploadFile.ajax",!0),xhr.upload.addEventListener("progress",uploadProgress,!1),xhr.send(a),null==pingInt&&(pingInt=setInterval("ping()",6e4)),xhr.onloadend=function(){if(null!=pingInt&&(window.clearInterval(pingInt),pingInt=null),200===xhr.status){var o=xhr.responseText;"uploadsuccess"==o?($("#uls_"+e).text("[已完成]"),e<t?doupload(e+1):(isUpLoading=!1,$("#filepath").removeAttr("disabled"),$("#uploadfile").val(""),$("#filepath").val(""),$("#pros").width("0%"),$("#pros").attr("aria-valuenow","0"),$("#umbutton").attr("disabled",!1),$("#filecount").text(""),$("#uploadstatus").text(""),$("#selectcount").text(""),$("#uploadFileModal").modal("hide"),showFolderView(locationpath))):"uploaderror"==o?(showUploadFileAlert("提示：出现意外错误，文件：["+l+"]上传失败，上传被中断。"),$("#uls_"+e).text("[失败]")):"filesTotalOutOfLimit"==o?(showUploadFileAlert("提示：该文件夹内存储的文件数量已达上限，文件：["+l+"]上传失败。您可以尝试将其上传至其他文件夹内。"),$("#uls_"+e).text("[失败]")):(showUploadFileAlert("提示：出现意外错误，文件：["+l+"]上传失败，上传被中断。"),$("#uls_"+e).text("[失败]"))}else showUploadFileAlert("提示：出现意外错误，文件：["+l+"]上传失败，上传被中断。"),$("#uls_"+e).text("[失败]")}}else showUploadFileAlert("提示：要上传的文件不存在。"),$("#uploadstatus").prepend("<p>未找到要上传的文件<span id='uls_"+e+"'>[失败]</span></p>")}function uploadProgress(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);$("#pros").width(t+"%"),$("#pros").attr("aria-valuenow",""+t)}}function showUploadFileAlert(e){isUpLoading=!1,$("#filepath").removeAttr("disabled"),$("#uploadFileAlert").show(),$("#uploadFileAlert").text(e),$("#umbutton").attr("disabled",!1)}function abortUpload(){isUpLoading&&(isUpLoading=!1,null!=xhr&&xhr.abort()),$("#uploadFileModal").modal("hide"),showFolderView(locationpath)}function showDownloadModel(e,t){$("#downloadFileName").text("提示：您确认要下载文件：["+t+"]么？"),$("#downloadHrefBox").html("<span class='text-muted'>正在生成...</span>"),getDownloadFileId=e,getDownloadFileName=t,$("#downloadFileBox").html("<button id='dlmbutton' type='button' class='btn btn-primary' onclick='dodownload(\""+e+"\")'>开始下载</button>"),$("#dlmbutton").attr("disabled",!1),$("#downloadModal").modal("show")}function dodownload(e){$("#dlmbutton").attr("disabled",!0),$("#downloadFileName").text("提示：准备开始下载，请稍候...");setTimeout("$('#downloadModal').modal('hide');",800);window.location.href="homeController/downloadFile.do?fileId="+e}function showDeleteFileModel(e,t){$("#deleteFileBox").html("<button id='dfmbutton' type='button' class='btn btn-danger' onclick='deleteFile(\""+e+"\")'>删除</button>"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1),$("#deleteFileMessage").text("提示：确定要彻底删除文件：["+t+"]么？该操作不可恢复"),$("#deleteFileModal").modal("toggle")}function deleteFile(e){$("#dfmbutton").attr("disabled",!0),$("#cancelDeleteFileBox").attr("disabled",!0),$("#deleteFileMessage").text("提示：正在删除，请稍候..."),$.ajax({type:"POST",dataType:"text",data:{fileId:e},url:"homeController/deleteFile.ajax",success:function(e){"mustLogin"==e?window.location.href="prv/login.html":"noAuthorized"==e?($("#deleteFileMessage").text("提示：您的操作未被授权，删除失败"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)):"errorParameter"==e?($("#deleteFileMessage").text("提示：参数不正确，删除失败"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)):"cannotDeleteFile"==e?($("#deleteFileMessage").text("提示：出现意外错误，可能未能删除文件"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)):"deleteFileSuccess"==e?($("#deleteFileModal").modal("hide"),showFolderView(locationpath)):($("#deleteFileMessage").text("提示：出现意外错误，可能未能删除文件"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1))},error:function(){$("#deleteFileMessage").text("提示：出现意外错误，可能未能删除文件"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)}})}function showRenameFileModel(e,t){$("#newFileNamealert").removeClass("alert"),$("#newFileNamealert").removeClass("alert-danger"),$("#filerenamebox").removeClass("has-error"),$("#newFileNamealert").text(""),$("#renameFileBox").html("<button type='button' class='btn btn-primary' onclick='renameFile(\""+e+"\")'>修改</button>"),$("#newfilename").val(t),$("#renameFileModal").modal("toggle")}function renameFile(e){var t=new RegExp('[/|\\\\*\\<\\>\\?\\:\\&\\$"]+',"g"),o=$("#newfilename").val();o.length>0?o.length<128?t.test(o)||0==o.indexOf(".")?showRFileAlert("提示：文件名中不应含有：引号 / \\ * | < > & $ : ? 且不能以“.”开头。"):$.ajax({type:"POST",dataType:"text",data:{fileId:e,newFileName:o},url:"homeController/renameFile.ajax",success:function(e){"mustLogin"==e?window.location.href="prv/login.html":"cannotRenameFile"==e?showRFileAlert("提示：出现意外错误，可能未能重命名文件，请刷新后重试。"):"renameFileSuccess"==e?($("#renameFileModal").modal("hide"),showFolderView(locationpath)):showRFileAlert("errorParameter"==e?"提示：参数错误，重命名失败，请刷新后重试。":"nameOccupied"==e?"提示：该名称已被占用，请选取其他名称。":"noAuthorized"==e?"提示：您的操作未被授权，重命名失败，请刷新后重试。":"提示：出现意外错误，可能未能重命名文件，请刷新后重试。")},error:function(){showRFileAlert("提示：出现意外错误，可能未能重命名文件。")}}):showRFileAlert("提示：文件名称太长。"):showRFileAlert("提示：文件名不能为空。")}function showRFileAlert(e){$("#newFileNamealert").addClass("alert"),$("#newFileNamealert").addClass("alert-danger"),$("#filerenamebox").addClass("has-error"),$("#newFileNamealert").text(e)}function getSuffix(e){var t=e.lastIndexOf("."),o=e.length;return e.substring(t+1,o).toLowerCase()}function playVideo(e){window.open("quickview/video.html?fileId="+e)}function pdfView(e){window.open("/pdfview/web/viewer.html?file=/resourceController/getResource/"+e)}function docxView(e){window.open("/pdfview/web/viewer.html?file=/resourceController/getWordView/"+e)}function txtView(e){window.open("/pdfview/web/viewer.html?file=/resourceController/getTxtView/"+e)}function pptView(e){window.open("/pdfview/web/viewer.html?file=/resourceController/getPPTView/"+e)}function showPicture(fileId){$.ajax({url:"homeController/getPrePicture.ajax",data:{fileId:fileId},type:"POST",dataType:"text",success:function(result){if("ERROR"!=result)if(pvl=eval("("+result+")"),pvl.pictureViewList.length<=viewerPageSize)createViewList();else{viewerPageIndex=Math.ceil((pvl.index+1)/viewerPageSize),viewerTotal=Math.ceil(pvl.pictureViewList.length/viewerPageSize),createViewListByPage();var innerIndex=pvl.index-(viewerPageIndex-1)*viewerPageSize;viewerPageIndex>1&&innerIndex++,viewer.viewer("view",innerIndex),viewer.viewer("show",!0)}else alert("错误：无法定位要预览的文件或该操作未被授权。")},error:function(){alert("错误：请求失败，请刷新重试。")}})}function createViewList(){if(null==viewer){for(var e=document.createElement("ul"),t=0;t<pvl.pictureViewList.length;t++)$(e).append("<li><img src='"+pvl.pictureViewList[t].url+"' alt='"+html2Escape(pvl.pictureViewList[t].fileName)+"' /></li>");(viewer=$(e)).viewer({loop:!1,hidden:function(){viewer.data("viewer").destroy(),viewer=null}})}viewer.viewer("view",pvl.index),viewer.viewer("show",!0)}function createViewListByPage(){if(null==viewer){var e=document.createElement("ul"),t=(viewerPageIndex-1)*viewerPageSize;viewerPageIndex>1&&$(e).append("<li><img src='css/left.png' alt='上一页' /></li>");for(var o=0;o<viewerPageSize&&o<pvl.pictureViewList.length-(viewerPageIndex-1)*viewerPageSize;o++)$(e).append("<li><img src='"+pvl.pictureViewList[t+o].url+"' alt='"+html2Escape(pvl.pictureViewList[t+o].fileName)+"' /></li>");viewerPageIndex<viewerTotal&&$(e).append("<li><img src='css/right.png' alt='下一页' /></li>"),(viewer=$(e)).viewer({loop:!1,view:function(e){0==e.detail.index&&1!=viewerPageIndex?(viewerPageIndex--,viewer.data("viewer").destroy(),viewer.empty(),viewer=null,createViewListByPage(),viewerPageIndex>1?viewer.viewer("view",viewerPageSize):viewer.viewer("view",viewerPageSize-1)):(e.detail.index==viewerPageSize+1||e.detail.index==viewerPageSize&&1==viewerPageIndex)&&(viewerPageIndex++,viewer.data("viewer").destroy(),viewer.empty(),viewer=null,createViewListByPage(),viewer.viewer("view",1))},hidden:function(){viewer.data("viewer").destroy(),viewer.empty(),viewer=null}})}}function isShift(e){return!!(window.event||e).shiftKey}function checkfile(e,t){isShift(e)?$("#"+t).hasClass("info")?$("#"+t).removeClass("info"):$("#"+t).addClass("info"):($(".filerow").removeClass("info"),$("#"+t).addClass("info"))}function checkConsFile(e,t){if(isShift(e)){var o=$("#"+t),l=o.index(),a=$(".filerow.info:last").index();if(-1!=a)if(a<l)for(;o[0]&&!o.hasClass("info");)o.addClass("info"),o=o.prev();else for(;o[0]&&!o.hasClass("info");)o.addClass("info"),o=o.next()}}function getCheckedFilesAndFolders(){var e=new Object;e.size=0;for(var t=new Array,o=new Array,l=$(".info").get(),a=0;a<l.length;a++)"true"==l[a].getAttribute("iskfolder")?o.push(l[a].id):t.push(l[a].id),e.size++;return e.filesId=JSON.stringify(t),e.foldersId=JSON.stringify(o),e}function checkallfile(){$(".filerow.info").length==$(".filerow").length?$(".filerow").removeClass("info"):$(".filerow").addClass("info")}function showDownloadAllCheckedModel(){if(folderView.enableDownloadZip){$("#downloadAllCheckedBox").html(""),$("#downloadAllCheckedLoad").text("");var e=getCheckedFilesAndFolders();0==e.size?$("#downloadAllCheckedName").html(checkFilesTip):($("#downloadAllCheckedName").text("提示：您确认要打包并下载这"+e.size+"项么？"),$("#downloadAllCheckedBox").html("<button id='dclmbutton' type='button' class='btn btn-primary' onclick='downloadAllChecked()'>开始下载</button>"),$("#dclmbutton").attr("disabled",!1)),$("#cancelDownloadAllCheckedBtn").attr("disabled",!1),$("#downloadAllCheckedModal").modal("toggle")}}function showDownloadAllCheckedModel(){$("#downloadAllCheckedBox").html(""),$("#downloadAllCheckedLoad").text("");var e=getCheckedFilesAndFolders();0==e.size?$("#downloadAllCheckedName").html(checkFilesTip):($("#downloadAllCheckedName").text("提示：您确认要打包并下载这"+e.size+"项么？"),$("#downloadAllCheckedBox").html("<button id='dclmbutton' type='button' class='btn btn-primary' onclick='downloadAllChecked()'>开始下载</button>"),$("#dclmbutton").attr("disabled",!1)),$("#cancelDownloadAllCheckedBtn").attr("disabled",!1),$("#downloadAllCheckedModal").modal("toggle")}function downloadAllChecked(){$("#dclmbutton").attr("disabled",!0),$("#cancelDownloadAllCheckedBtn").attr("disabled",!0);var e=getCheckedFilesAndFolders();$("#downloadAllCheckedName").text("提示：服务器正在对选中资源进行压缩（共"+e.size+"项），这可能需要一些时间（文件越大耗时越长），压缩完成将自动开始下载。"),$.ajax({url:"homeController/getPackTime.ajax",type:"POST",data:{strIdList:e.filesId,strFidList:e.foldersId},dataType:"text",success:function(e){if("0"!=e){var t=0;$("#downloadAllCheckedLoad").text("已耗时："+t+"秒（预计耗时："+e+"）"),zipTimer=setInterval(function(){t++,$("#downloadAllCheckedLoad").text("已耗时："+t+"秒（预计耗时："+e+"）")},1e3)}else{t=0;$("#downloadAllCheckedLoad").text("已耗时："+t+"秒"),zipTimer=setInterval(function(){t++,$("#downloadAllCheckedLoad").text("已耗时："+t+"秒")},1e3)}},error:function(){$("#downloadAllCheckedLoad").text("（无法获取预计耗时）")}}),$.ajax({type:"POST",url:"homeController/downloadCheckedFiles.ajax",data:{strIdList:e.filesId,strFidList:e.foldersId},dataType:"text",success:function(e){if(null!=zipTimer&&window.clearInterval(zipTimer),"ERROR"==e)$("#downloadAllCheckedName").text("提示：压缩过程出错。无法完成压缩，请重试或告知管理员。"),$("#dclmbutton").attr("disabled",!1),$("#cancelDownloadAllCheckedBtn").attr("disabled",!1);else{$("#downloadAllCheckedLoad").text(""),$("#downloadAllCheckedName").text("提示：压缩完成！准备开始下载...");setTimeout("$('#downloadAllCheckedModal').modal('hide');",800);var t=document.createElement("form");t.action="homeController/downloadCheckedFilesZip.do",t.method="post",t.style.display="none";var o=document.createElement("input");o.name="zipId",o.value=e,t.appendChild(o),document.body.appendChild(t),t.submit()}},error:function(){$("#downloadAllCheckedName").text("提示：请求失败。无法完成压缩，请重试或告知管理员。"),$("#dclmbutton").attr("disabled",!1),$("#cancelDownloadAllCheckedBtn").attr("disabled",!1)}})}function showDeleteAllCheckedModel(){$("#deleteFileBox").html("");var e=getCheckedFilesAndFolders();$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1),0==e.size?$("#deleteFileMessage").html(checkFilesTip):($("#deleteFileBox").html("<button id='dfmbutton' type='button' class='btn btn-danger' onclick='deleteAllChecked()'>全部删除</button>"),$("#deleteFileMessage").text("提示：确定要彻底删除这"+e.size+"项么？该操作不可恢复！")),$("#deleteFileModal").modal("toggle")}function deleteAllChecked(){var e=getCheckedFilesAndFolders();$("#dfmbutton").attr("disabled",!0),$("#cancelDeleteFileBox").attr("disabled",!0),$("#deleteFileMessage").text("提示：正在删除，请稍候..."),$.ajax({type:"POST",dataType:"text",data:{strIdList:e.filesId,strFidList:e.foldersId},url:"homeController/deleteCheckedFiles.ajax",success:function(e){"mustLogin"==e?window.location.href="prv/login.html":"noAuthorized"==e?($("#deleteFileMessage").text("提示：您的操作未被授权，删除失败"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)):"errorParameter"==e?($("#deleteFileMessage").text("提示：参数不正确，未能全部删除文件"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)):"cannotDeleteFile"==e?($("#deleteFileMessage").text("提示：出现意外错误，可能未能删除全部文件"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)):"deleteFileSuccess"==e?($("#deleteFileModal").modal("hide"),showFolderView(locationpath)):($("#deleteFileMessage").text("提示：出现意外错误，可能未能删除全部文件"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1))},error:function(){$("#deleteFileMessage").text("提示：出现意外错误，可能未能删除全部文件"),$("#dfmbutton").attr("disabled",!1),$("#cancelDeleteFileBox").attr("disabled",!1)}})}function playAudio(fileId){$("#audioPlayerModal").modal("show"),null==pingInt&&(pingInt=setInterval("ping()",6e4)),null==ap&&(ap=new APlayer({container:document.getElementById("aplayer"),lrcType:3,mutex:!0,volume:.7,theme:"#EDEDED",audio:[]}),ap.on("pause",function(){$("#playOrPause").html("<span class='glyphicon glyphicon-play' aria-hidden='true'></span>")}),ap.on("play",function(){$("#playOrPause").html("<span class='glyphicon glyphicon-pause' aria-hidden='true'></span>")})),ap.list.clear(),$.ajax({url:"homeController/playAudios.ajax",data:{fileId:fileId},type:"POST",dataType:"text",success:function(result){for(var ail=eval("("+result+")"),i=ail.index;i<ail.as.length;i++)ail.as[i].name=ail.as[i].name.replace("'","&#39;").replace("<","&lt;").replace(">","&gt;"),ap.list.add(ail.as[i]);for(var i=0;i<ail.index;i++)ail.as[i].name=ail.as[i].name.replace("'","&#39;").replace("<","&lt;").replace(">","&gt;"),ap.list.add(ail.as[i]);audio_play()},error:function(){alert("错误：无法获取音乐列表，请稍后再试"),closeAudioPlayer()}})}function closeAudioPlayer(){$("#audioPlayerModal").modal("hide")}function audio_playOrPause(){ap.toggle()}function audio_play(){ap.play()}function audio_pasue(){ap.pause()}function audio_fw(){ap.skipForward()}function audio_bw(){ap.skipBack()}function audio_vulome_up(){ap.volume(ap.audio.volume+.1,!0)}function audio_vulome_down(){ap.volume(ap.audio.volume-.1,!0)}function sortbyfn(){if(loadingComplete&&!$("#sortByCD,#sortByFS,#sortByCN,#sortByOR").hasClass("glyphicon glyphicon-hourglass")){$("#sortByCD").removeClass(),$("#sortByFS").removeClass(),$("#sortByCN").removeClass(),$("#sortByOR").removeClass();var e=1;$("#sortByFN").hasClass("glyphicon-triangle-bottom")&&(e=-1),$("#sortByFN").removeClass(),$("#sortByFN").addClass("glyphicon glyphicon-hourglass"),setTimeout(function(){folderView.fileList.sort(function(t,o){return e*o.fileName.localeCompare(t.fileName,"zh")}),folderView.folderList.sort(function(t,o){return e*o.folderName.localeCompare(t.folderName,"zh")}),showFolderTable(folderView),$("#sortByFN").removeClass(),-1==e?$("#sortByFN").addClass("glyphicon glyphicon-triangle-top"):$("#sortByFN").addClass("glyphicon glyphicon-triangle-bottom")},0)}}function sortbycd(){if(loadingComplete&&!$("#sortByFN,#sortByFS,#sortByCN,#sortByOR").hasClass("glyphicon glyphicon-hourglass")){$("#sortByFN").removeClass(),$("#sortByFS").removeClass(),$("#sortByCN").removeClass(),$("#sortByOR").removeClass();var e=1;$("#sortByCD").hasClass("glyphicon-triangle-bottom")&&(e=-1),$("#sortByCD").removeClass(),$("#sortByCD").addClass("glyphicon glyphicon-hourglass"),setTimeout(function(){folderView.fileList.sort(function(t,o){var l=t.fileCreationDate.replace("年","-").replace("月","-").replace("日",""),a=o.fileCreationDate.replace("年","-").replace("月","-").replace("日",""),r=new Date(Date.parse(l)).getTime()-new Date(Date.parse(a)).getTime();return e*r}),folderView.folderList.sort(function(t,o){var l=t.folderCreationDate.replace("年","-").replace("月","-").replace("日",""),a=o.folderCreationDate.replace("年","-").replace("月","-").replace("日",""),r=new Date(Date.parse(l)).getTime()-new Date(Date.parse(a)).getTime();return e*r}),showFolderTable(folderView),$("#sortByCD").removeClass(),-1==e?$("#sortByCD").addClass("glyphicon glyphicon-triangle-top"):$("#sortByCD").addClass("glyphicon glyphicon-triangle-bottom")},0)}}function sortbyfs(){if(loadingComplete&&!$("#sortByFN,#sortByCD,#sortByCN,#sortByOR").hasClass("glyphicon glyphicon-hourglass")){$("#sortByFN").removeClass(),$("#sortByCD").removeClass(),$("#sortByCN").removeClass(),$("#sortByOR").removeClass();var e=1;$("#sortByFS").hasClass("glyphicon-triangle-bottom")&&(e=-1),$("#sortByFS").removeClass(),$("#sortByFS").addClass("glyphicon glyphicon-hourglass"),setTimeout(function(){folderView.fileList.sort(function(t,o){return e*(t.fileSize-o.fileSize)}),showFolderTable(folderView),$("#sortByFS").removeClass(),-1==e?$("#sortByFS").addClass("glyphicon glyphicon-triangle-top"):$("#sortByFS").addClass("glyphicon glyphicon-triangle-bottom")},0)}}function sortbycn(){if(loadingComplete&&!$("#sortByFN,#sortByCD,#sortByFS,#sortByOR").hasClass("glyphicon glyphicon-hourglass")){$("#sortByFN").removeClass(),$("#sortByCD").removeClass(),$("#sortByFS").removeClass(),$("#sortByOR").removeClass();var e=1;$("#sortByCN").hasClass("glyphicon-triangle-bottom")&&(e=-1),$("#sortByCN").removeClass(),$("#sortByCN").addClass("glyphicon glyphicon-hourglass"),setTimeout(function(){folderView.fileList.sort(function(t,o){return e*o.fileCreatorName.localeCompare(t.folderCreatorName,"zh")}),folderView.folderList.sort(function(t,o){return e*o.folderCreatorName.localeCompare(t.folderCreatorName,"zh")}),showFolderTable(folderView),$("#sortByCN").removeClass(),-1==e?$("#sortByCN").addClass("glyphicon glyphicon-triangle-top"):$("#sortByCN").addClass("glyphicon glyphicon-triangle-bottom")},0)}}function showOriginFolderView(){loadingComplete&&($("#sortByFN,#sortByCD,#sortByFS,#sortByCN").hasClass("glyphicon glyphicon-hourglass")||($("#sortByFN").removeClass(),$("#sortByCD").removeClass(),$("#sortByFS").removeClass(),$("#sortByCN").removeClass(),$("#sortByOR").addClass("glyphicon glyphicon-hourglass"),setTimeout(function(){showFolderTable(folderView=null!=screenedFoldrView?$.extend(!0,{},screenedFoldrView):$.extend(!0,{},originFolderView)),$("#sortByOR").removeClass()},0)))}function cutFile(){null==(checkedMovefiles=getCheckedFilesAndFolders())||0==checkedMovefiles.size?($("#moveFilesMessage").html(checkFilesTip),$("#selectFileMoveModelAsAll").removeAttr("checked"),$("#selectFileMoveModelAlert").hide(),$("#moveFilesModal").modal("show")):(checkedMovefiles.size<100?$("#stickFilesCount").text("（"+checkedMovefiles.size+"）"):$("#stickFilesCount").text("（99+）"),$("#copyFileButtonLi").removeClass("show"),$("#copyFileButtonLi").addClass("hidden"),$("#cutFileButtonLi").removeClass("show"),$("#cutFileButtonLi").addClass("hidden"),$("#stickFileButtonLi").removeClass("hidden"),$("#stickFileButtonLi").addClass("show"),isCopy=!1)}function copyFile(){null==(checkedMovefiles=getCheckedFilesAndFolders())||0==checkedMovefiles.size?($("#moveFilesMessage").html(checkFilesTip),$("#selectFileMoveModelAsAll").removeAttr("checked"),$("#selectFileMoveModelAlert").hide(),$("#moveFilesModal").modal("show")):(checkedMovefiles.size<100?$("#stickFilesCount").text("（"+checkedMovefiles.size+"）"):$("#stickFilesCount").text("（99+）"),$("#copyFileButtonLi").removeClass("show"),$("#copyFileButtonLi").addClass("hidden"),$("#cutFileButtonLi").removeClass("show"),$("#cutFileButtonLi").addClass("hidden"),$("#stickFileButtonLi").removeClass("hidden"),$("#stickFileButtonLi").addClass("show"),isCopy=!0)}function stickFile(){void 0!==checkedMovefiles&&checkedMovefiles.size>0&&(isCopy?($("#moveFilesMessage").text("提示：确定将这"+checkedMovefiles.size+"项复制到当前位置么？"),$("#moveFilesBox").html("<button id='dmvfbutton' type='button' class='btn btn-primary' onclick='doMoveFiles()'>全部复制</button>")):($("#moveFilesMessage").text("提示：确定将这"+checkedMovefiles.size+"项移动到当前位置么？"),$("#moveFilesBox").html("<button id='dmvfbutton' type='button' class='btn btn-danger' onclick='doMoveFiles()'>全部移动</button>")),$("#selectFileMoveModelAsAll").removeAttr("checked"),$("#cancelMoveFilesBtn").attr("disabled",!1),$("#selectFileMoveModelAlert").hide(),$("#moveFilesModal").modal("show"))}function doMoveFiles(){$("#dmvfbutton").attr("disabled",!0),$("#cancelMoveFilesBtn").attr("disabled",!0);var method="MOVE";isCopy?($("#moveFilesMessage").text("提示：正在复制，请稍候..."),method="COPY"):$("#moveFilesMessage").text("提示：正在移动，请稍候..."),$.ajax({type:"POST",dataType:"text",data:{strIdList:checkedMovefiles.filesId,strFidList:checkedMovefiles.foldersId,locationpath:locationpath,method:method},url:"homeController/confirmMoveFiles.ajax",success:function(result){if("mustLogin"==result)window.location.href="prv/login.html";else switch(result){case"noAuthorized":$("#moveFilesMessage").text("提示：您的操作未被授权，操作失败"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"errorParameter":$("#moveFilesMessage").text("提示：参数不正确，无法完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"cannotMoveFiles":$("#moveFilesMessage").text("提示：出现意外错误，可能未能完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"filesTotalOutOfLimit":$("#moveFilesMessage").text("提示：该文件夹内存储的文件数量已达上限，无法添加更多文件"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"foldersTotalOutOfLimit":$("#moveFilesMessage").text("提示：该文件夹内存储的文件夹数量已达上限，无法添加更多文件夹"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"confirmMoveFiles":strMoveOptMap={},sendMoveFilesReq();break;default:if(result.startsWith("duplicationFileName:")){repeMap=eval("("+result.substring(20)+")"),repeIndex=0,strMoveOptMap={},mRepeSize=repeMap.repeFolders.length+repeMap.repeNodes.length,repeMap.repeFolders.length>0?$("#mrepeFileName").text(repeMap.repeFolders[repeIndex].folderName):$("#mrepeFileName").text(repeMap.repeNodes[repeIndex].fileName);var authList=originFolderView.authList;checkAuth(authList,"D")?$("#movecoverbtn").show():$("#movecoverbtn").hide(),$("#selectFileMoveModelAlert").show()}else result.startsWith("CANT_MOVE_TO_INSIDE:")?$("#moveFilesMessage").text("错误：不能将一个文件夹移动到其自身内部："+result.substring(20)):($("#moveFilesMessage").text("提示：出现意外错误，可能未能完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1))}},error:function(){$("#moveFilesMessage").text("提示：出现意外错误，可能未能完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1)}})}function selectFileMoveModel(e){if($("#selectFileMoveModelAsAll").prop("checked")){for(;repeIndex<mRepeSize;)repeIndex<repeMap.repeFolders.length?strMoveOptMap[repeMap.repeFolders[repeIndex].folderId]=e:strMoveOptMap[repeMap.repeNodes[repeIndex-repeMap.repeFolders.length].fileId]=e,repeIndex++;$("#selectFileMoveModelAlert").hide(),sendMoveFilesReq()}repeIndex<repeMap.repeFolders.length?strMoveOptMap[repeMap.repeFolders[repeIndex].folderId]=e:strMoveOptMap[repeMap.repeNodes[repeIndex-repeMap.repeFolders.length].fileId]=e,++repeIndex<mRepeSize?repeIndex<repeMap.repeFolders.length?$("#mrepeFileName").text(repeMap.repeFolders[repeIndex].folderName):$("#mrepeFileName").text(repeMap.repeNodes[repeIndex-repeMap.repeFolders.length].fileName):($("#selectFileMoveModelAlert").hide(),sendMoveFilesReq())}function sendMoveFilesReq(){var e=JSON.stringify(strMoveOptMap),t="MOVE";isCopy&&(t="COPY"),$.ajax({type:"POST",dataType:"text",data:{strIdList:checkedMovefiles.filesId,strFidList:checkedMovefiles.foldersId,strOptMap:e,locationpath:locationpath,method:t},url:"homeController/moveCheckedFiles.ajax",success:function(e){if("mustLogin"==e)window.location.href="prv/login.html";else switch(e){case"noAuthorized":$("#moveFilesMessage").text("提示：您的操作未被授权，操作失败"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"errorParameter":$("#moveFilesMessage").text("提示：参数不正确，无法完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"filesTotalOutOfLimit":$("#moveFilesMessage").text("提示：该文件夹内存储的文件数量已达上限，无法添加更多文件"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"foldersTotalOutOfLimit":$("#moveFilesMessage").text("提示：该文件夹内存储的文件夹数量已达上限，无法添加更多文件夹"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"cannotMoveFiles":$("#moveFilesMessage").text("提示：出现意外错误，可能未能完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1);break;case"moveFilesSuccess":$("#moveFilesModal").modal("hide"),showFolderView(locationpath);break;default:$("#moveFilesMessage").text("提示：出现意外错误，可能未能完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1)}},error:function(){$("#moveFilesMessage").text("提示：出现意外错误，可能未能完成此操作，请刷新后重试"),$("#dmvfbutton").attr("disabled",!1),$("#cancelMoveFilesBtn").attr("disabled",!1)}})}function doSearchFile(){var e=$("#sreachKeyWordIn").val();0!=e.length?e.startsWith("all:")||e.startsWith("all：")?selectInCompletePath(e.substring(4)):(startLoading(),selectInThisPath(e),endLoading()):null!=folderView.keyWorld?showFolderView(locationpath):(screenedFoldrView=null,showOriginFolderView())}function selectInThisPath(e){try{var t=new RegExp(e+"+");(screenedFoldrView=$.extend(!0,{},originFolderView)).folderList=[],screenedFoldrView.fileList=[];for(var o=0,l=originFolderView.folderList.length;o<l;o++)t.test(originFolderView.folderList[o].folderName)&&screenedFoldrView.folderList.push(originFolderView.folderList[o]);for(o=0,l=originFolderView.fileList.length;o<l;o++)t.test(originFolderView.fileList[o].fileName)&&screenedFoldrView.fileList.push(originFolderView.fileList[o]);$("#sortByFN").removeClass(),$("#sortByCD").removeClass(),$("#sortByFS").removeClass(),$("#sortByCN").removeClass(),$("#sortByOR").removeClass(),showFolderTable(folderView=$.extend(!0,{},screenedFoldrView))}catch(e){alert("错误：搜索关键字有误。请在特殊符号（例如“*”）前加上“\\”进行转义。")}}function selectInCompletePath(keyworld){0!=keyworld.length?(startLoading(),$.ajax({type:"POST",dataType:"text",data:{fid:locationpath,keyworld:keyworld},url:"homeController/sreachInCompletePath.ajax",success:function(result){endLoading(),"ERROR"==result?(doAlert(),$("#tb").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#publishTime").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#parentlistbox").html("<span class='graytext'>获取失败，请尝试刷新</span>")):"mustLogin"==result?window.location.href="prv/login.html":"notAccess"==result?(document.cookie="folder_id="+escape("root"),window.location.href="/"):(folderView=eval("("+result+")"),locationpath=folderView.folder.folderId,parentpath=folderView.folder.folderParent,constraintLevel=folderView.folder.folderConstraint,screenedFoldrView=null,$("#sreachKeyWordIn").val("all:"+folderView.keyWorld),showParentList(folderView),showAccountView(folderView),showPublishTime(folderView),originFolderView=$.extend(!0,{},folderView),$("#sortByFN").removeClass(),$("#sortByCD").removeClass(),$("#sortByFS").removeClass(),$("#sortByCN").removeClass(),$("#sortByOR").removeClass(),showFolderTable(folderView),$("#fim_name").text(folderView.folder.folderName),$("#fim_creator").text("--"),$("#fim_folderCreationDate").text("--"),$("#fim_folderId").text("--"),updateTheFolderInfo())},error:function(){endLoading(),doAlert(),$("#tb").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#publishTime").html("<span class='graytext'>获取失败，请尝试刷新</span>"),$("#parentlistbox").html("<span class='graytext'>获取失败，请尝试刷新</span>")}})):showFolderView(locationpath)}function goBackToTop(){$("html,body").animate({scrollTop:0},"slow")}function getDownloadURL(){$.ajax({url:"externalLinksController/getDownloadKey.ajax",type:"POST",dataType:"text",data:{fId:getDownloadFileId},success:function(e){var t=window.location.protocol+"//"+window.location.host+"/externalLinksController/downloadFileByKey/"+encodeURIComponent(getDownloadFileName.replace(/\\/g,"_"))+"?dkey="+e;$("#downloadHrefBox").html("<a href='"+t+"'>"+t+"</a>")},error:function(){$("#downloadHrefBox").html("<span class='text-muted'>获取失败，请检查网络状态或<a href='javascript:void(0);' onclick='getDownloadURL()'>点此</a>重新获取。</span>")}})}function ping(){$.ajax({url:"homeController/ping.ajax",type:"POST",dataType:"text",data:{},success:function(e){"pong"!=e&&null!=pingInt&&(window.clearInterval(pingInt),pingInt=null)},error:function(){null!=pingInt&&(window.clearInterval(pingInt),pingInt=null)}})}function isSupportWebkitdirectory(){return"webkitdirectory"in document.createElement("input")&&!/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)}function showImportAccountExcelModel(){$("#importExcelAlert").removeClass("alert"),$("#importExcelAlert").removeClass("alert-danger"),$("#importExcelAlert").text(""),$("#importAccountExcelModal").modal("show")}function showUploadFolderModel(){if($("#importFolderAlert").hide(),$("#importFolderAlert").text(""),0==isImporting)if($("#folderpath").val(""),$("#importfolder").val(""),$("#importpros").width("0%"),$("#importpros").attr("aria-valuenow","0"),$("#importstatus").html(""),$("#folderpath").attr("disabled",!1),$("#importFolderLevelBtn").attr("disabled",!1),$("#importcount").text(""),$("#importbutton").attr("disabled",!1),$("#importfoldertypelist").html(""),$("#selectFolderImportModelAlert").hide(),null!=account){$("#folderpath").attr("folderConstraintLevel",constraintLevel+""),$("#importfoldertype").text(folderTypes[constraintLevel]);for(var e=constraintLevel;e<folderTypes.length;e++)$("#importfoldertypelist").append("<li><a onclick='changeImportFolderType("+e+")'>"+folderTypes[e]+"</a></li>")}else $("#importfoldertypelist").append("<li><a onclick='changeImportFolderType(0)'>"+folderTypes[0]+"</a></li>");$("#importFolderModal").modal("show")}function checkimportpath(){$("#importfolder").click()}function getInputImport(){(ifs=$("#importfolder")[0].files).length>0&&(importFolderName=ifs[0].webkitRelativePath.substring(0,ifs[0].webkitRelativePath.indexOf("/")),$("#folderpath").val(importFolderName))}function checkImportFolder(){if(0==isUpLoading&&0==isImporting)if(null!=ifs&&ifs.length>0){$("#folderpath").attr("disabled",!0),$("#importFolderLevelBtn").attr("disabled",!0),$("#importbutton").attr("disabled",!0),$("#importFolderAlert").hide(),$("#importFolderAlert").text(""),isImporting=!0;for(var maxSize=0,maxFileIndex=0,i=0;i<ifs.length;i++)ifs[i].size>maxSize&&(maxSize=ifs[i].size,maxFileIndex=i);uploadTargetFolder=locationpath,$.ajax({url:"homeController/checkImportFolder.ajax",type:"POST",dataType:"text",data:{folderName:importFolderName,maxSize:maxSize,folderId:uploadTargetFolder},success:function(result){var resJson=eval("("+result+")");switch(resJson.result){case"noAuthorized":showImportFolderAlert("提示：您的操作未被授权，无法开始上传");break;case"errorParameter":showImportFolderAlert("提示：参数不正确，无法开始上传。必须选择一个文件夹");break;case"mustLogin":window.location.href="prv/login.html";break;case"fileOverSize":showImportFolderAlert("提示：文件["+ifs[maxFileIndex].webkitRelativePath+"]的体积超过最大限制（"+resJson.maxSize+"），无法开始上传");break;case"foldersTotalOutOfLimit":showImportFolderAlert("提示：该文件夹内存储的文件夹数量已达上限，无法在其中上传更多文件夹。您可以尝试将其上传至其他文件夹内。");break;case"repeatFolder_Both":$("#repeFolderName").text(importFolderName),$("#importcoverbtn").hide(),$("#selectFolderImportModelAlert").show();break;case"repeatFolder_coverOrBoth":$("#repeFolderName").text(importFolderName),$("#importcoverbtn").show(),$("#selectFolderImportModelAlert").show();break;case"permitUpload":iteratorImport(0);break;default:showImportFolderAlert("提示：出现意外错误，无法开始上传")}},error:function(){showImportFolderAlert("提示：出现意外错误，无法开始上传")}})}else showImportFolderAlert("提示：您未选择任何文件夹，无法开始上传");else showImportFolderAlert("提示：另一项上传文件或文件夹的任务尚未完成，无法开始上传")}function showImportFolderAlert(e){isImporting=!1,$("#folderpath").attr("disabled",!1),$("#importFolderLevelBtn").attr("disabled",!1),$("#importFolderAlert").show(),$("#importFolderAlert").text(e),$("#importbutton").attr("disabled",!1)}function importProgress(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);$("#importpros").width(t+"%"),$("#importpros").attr("aria-valuenow",""+t)}}function importAndCover(){$("#selectFolderImportModelAlert").hide(),$.ajax({url:"homeController/deleteFolderByName.ajax",type:"POST",data:{parentId:uploadTargetFolder,folderName:importFolderName},dataType:"text",success:function(e){"deleteSuccess"==e?iteratorImport(0):showImportFolderAlert("提示：无法覆盖原文件夹，上传失败")},error:function(){showImportFolderAlert("提示：无法覆盖原文件夹，上传失败")}})}function importAndBoth(){$("#selectFolderImportModelAlert").hide();var fc=$("#folderpath").attr("folderConstraintLevel");$.ajax({url:"homeController/createNewFolderByName.ajax",type:"POST",data:{parentId:uploadTargetFolder,folderName:importFolderName,folderConstraint:fc},dataType:"text",success:function(result){var resJson=eval("("+result+")");"success"==resJson.result?iteratorImport(0,resJson.newName):"foldersTotalOutOfLimit"==resJson.result?showImportFolderAlert("提示：该文件夹内存储的文件夹数量已达上限，无法上传同名文件夹并保留两者。您可以尝试将其上传至其他文件夹内。"):showImportFolderAlert("提示：生成新文件夹名称失败，无法开始上传")},error:function(){showImportFolderAlert("提示：生成新文件夹名称失败，无法开始上传")}})}function iteratorImport(e,t){$("#importpros").width("0%"),$("#importpros").attr("aria-valuenow","0");var o=ifs[e],l=ifs.length,a=$("#folderpath").attr("folderConstraintLevel");if(null!=o){var r=o.webkitRelativePath;l>1&&$("#importcount").text("（"+(e+1)+"/"+l+"）"),$("#importstatus").prepend("<p>"+html2Escape(r)+"<span id='ils_"+e+"'>[正在上传...]</span></p>"),xhr=new XMLHttpRequest;var i=new FormData;i.append("file",o),i.append("folderId",uploadTargetFolder),i.append("folderConstraint",a),i.append("originalFileName",r),t&&i.append("newFolderName",t),xhr.open("POST","homeController/doImportFolder.ajax",!0),xhr.upload.addEventListener("progress",importProgress,!1),xhr.send(i),null==pingInt&&(pingInt=setInterval("ping()",6e4)),xhr.onloadend=function(){if(null!=pingInt&&(window.clearInterval(pingInt),pingInt=null),200===xhr.status){var o=xhr.responseText;if("uploadsuccess"==o){$("#ils_"+e).text("[已完成]");var a=e+1;a<l?iteratorImport(a,t):(isImporting=!1,$("#folderpath").removeAttr("disabled"),$("#importFolderLevelBtn").removeAttr("disabled"),$("#importfolder").val(""),$("#folderpath").val(""),$("#importpros").width("0%"),$("#importpros").attr("aria-valuenow","0"),$("#importbutton").attr("disabled",!1),$("#importcount").text(""),$("#importstatus").text(""),$("#importFolderModal").modal("hide"),showFolderView(locationpath))}else"uploaderror"==o?(showImportFolderAlert("提示：出现意外错误，文件：["+r+"]上传失败，上传被中断。"),$("#ils_"+e).text("[失败]")):"foldersTotalOutOfLimit"==o?(showImportFolderAlert("提示：该文件夹内存储的文件夹数量已达上限，文件：["+r+"]上传失败，上传被中断。"),$("#ils_"+e).text("[失败]")):"filesTotalOutOfLimit"==o?(showImportFolderAlert("提示：该文件夹内存储的文件数量已达上限，文件：["+r+"]上传失败，上传被中断。"),$("#ils_"+e).text("[失败]")):(showImportFolderAlert("提示：出现意外错误，文件：["+r+"]上传失败，上传被中断。"),$("#ils_"+e).text("[失败]"))}else showImportFolderAlert("提示：出现意外错误，文件：["+r+"]上传失败，上传被中断。"),$("#ils_"+e).text("[失败]")}}else showImportFolderAlert("提示：要上传的文件不存在。"),$("#importstatus").prepend("<p>未找到要上传的文件<span id='ils_"+e+"'>[失败]</span></p>")}function abortImport(){isImporting&&(isImporting=!1,null!=xhr&&xhr.abort()),$("#importFolderModal").modal("hide"),showFolderView(locationpath)}function changeImportFolderType(e){$("#importfoldertype").text(folderTypes[e]),$("#folderpath").attr("folderConstraintLevel",e+"")}function doChangePassword(){$("#changepassword_oldepwdbox,#changepassword_newpwdbox,#changepassword_reqnewpwdbox").removeClass("has-error"),$("#changepasswordalertbox").hide();var change_oldPassword=$("#changepassword_oldpwd").val(),change_newPassword=$("#changepassword_newpwd").val(),change_reqNewPassword=$("#changepassword_reqnewpwd").val();return 0==change_oldPassword.length?($("#changepassword_oldepwdbox").addClass("has-error"),void $("#changepassword_oldpwd").focus()):0==change_newPassword.length?($("#changepassword_newpwdbox").addClass("has-error"),void $("#changepassword_newpwd").focus()):0==change_reqNewPassword.length?($("#changepassword_reqnewpwdbox").addClass("has-error"),void $("#changepassword_reqnewpwd").focus()):(isChangingPassword=!0,$("#changepassword_oldpwd,#changepassword_newpwd,#changepassword_reqnewpwd,#changePasswordButton,#changepassword_vercode").attr("disabled",!0),change_newPassword+""!=change_reqNewPassword+""?(showChangePasswordAlert("提示：两次输入的新密码不一致，请检查确认"),$("#changepassword_newpwdbox").addClass("has-error"),void $("#changepassword_reqnewpwdbox").addClass("has-error")):void $.ajax({url:"homeController/getPublicKey.ajax",type:"POST",data:{},dataType:"text",success:function(result){var changepwd_publicKeyInfo=eval("("+result+")"),changePasswordInfo='{oldPwd:"'+change_oldPassword+'",newPwd:"'+change_newPassword+'",time:"'+changepwd_publicKeyInfo.time+'"}',encrypt=new JSEncrypt;encrypt.setPublicKey(changepwd_publicKeyInfo.publicKey);var encrypted=encrypt.encrypt(changePasswordInfo);sendChangePasswordInfo(encrypted)},error:function(){showChangePasswordAlert("提示：密码修改失败，请检查网络链接或服务器运行状态")}}))}function sendChangePasswordInfo(e){$.ajax({type:"POST",dataType:"text",url:"homeController/doChangePassword.ajax",data:{encrypted:e,vercode:$("#changepassword_vercode").val()},success:function(e){switch($("#changepassword_vccodebox").hide(),isChangingPassword=!1,e){case"success":$("#changePasswordModal").modal("hide");break;case"mustlogin":showChangePasswordAlert("提示：登录已失效或尚未登录账户，请刷新并登陆账户");break;case"illegal":showChangePasswordAlert("提示：用户修改密码功能已被禁用，请求被拒绝");break;case"oldpwderror":showChangePasswordAlert("提示：旧密码输入错误，请求被拒绝"),$("#changepassword_oldepwdbox").addClass("has-error");break;case"needsubmitvercode":$("#changepassword_oldpwd,#changepassword_newpwd,#changepassword_reqnewpwd,#changePasswordButton").attr("disabled",!1),$("#changepassword_vccodebox").html("<label id='changepassword_vercodetitle' class='col-sm-5'><img id='changepassword_showvercode' class='vercodeimg' alt='点击获取验证码' src='homeController/getNewVerCode.do?s="+(new Date).getTime()+"' onclick='changePasswordGetNewVerCode()'></label><div class='col-sm-7'><input type='text' class='form-control' id='changepassword_vercode' placeholder='验证码……'></div>"),$("#changepassword_vccodebox").show(),isChangingPassword=!1;break;case"invalidnewpwd":showChangePasswordAlert("提示：密码修改失败，新密码不合法。新密码的长度需为3-32个字符，且仅支持ISO-8859-1中的字符（推荐使用英文字母、英文符号及阿拉伯数字）。");break;case"error":showChangePasswordAlert("提示：密码修改失败，修改请求无法通过加密效验（可能是请求耗时过长导致的）");break;case"cannotchangepwd":showChangePasswordAlert("提示：密码修改失败，发生意外错误，请稍后重试或联系管理员");break;default:showChangePasswordAlert("提示：密码修改失败，发生未知错误")}},error:function(){showChangePasswordAlert("提示：密码修改失败，请检查网络链接或服务器运行状态")}})}function showChangePasswordAlert(e){isChangingPassword=!1,$("#changepassword_oldpwd,#changepassword_newpwd,#changepassword_reqnewpwd,#changePasswordButton,#changepassword_vercode").attr("disabled",!1),$("#changepasswordalertbox").show(),$("#changepasswordalertbox").text(e)}function changePasswordGetNewVerCode(){$("#changepassword_showvercode").attr("src","homeController/getNewVerCode.do?s="+(new Date).getTime())}function getFileChain(e,t){$("#fileChainTextarea").text("正在获取……"),$("#copyChainBtn").attr("disabled",!0),$("#fileChainModal").modal("show"),$.ajax({type:"POST",dataType:"text",url:"homeController/getFileChainKey.ajax",data:{fid:e},success:function(e){switch(e){case"ERROR":$("#fileChainTextarea").text("提示：获取失败，请刷新页面或稍后再试。");break;case"mustlogin":window.location.href="prv/login.html";break;default:$("#fileChainTextarea").text(window.location.protocol+"//"+window.location.host+"/externalLinksController/chain/"+encodeURIComponent(t.replace(/\\/g,"_"))+"?ckey="+encodeURIComponent(e)),$("#copyChainBtn").attr("disabled",!1)}},error:function(){$("#fileChainTextarea").text("提示：获取失败，无法连接服务器。")}})}function copyFileChain(){document.getElementById("fileChainTextarea").select(),document.execCommand("copy")}function showNoticeModal(){$("#noticeModal").modal("show")}function initNoticeModal(){$("#noticeModalBody").load("resourceController/getNoticeContext.do",function(){$("#noticeModalBody img").css("max-width","100%"),winHeight>=300?$("#noticeModalBody").css("max-height",winHeight-180+"px"):$("#noticeModalBody").css("max-height","300px"),noticeInited=!0,showNoticeModal(),showNoticeBtn()})}function subscribeNotice(){$.ajax({url:"resourceController/getNoticeMD5.ajax",data:{},type:"POST",dataType:"text",success:function(e){if(""!=e){var t=document.cookie.match(new RegExp("(^| )notice_md5=([^;]*)(;|$)"));if(t){if(e==unescape(t[2]))return void showNoticeBtn()}else if((t=document.cookie.match(new RegExp("(^| )notice_md5_30=([^;]*)(;|$)")))&&e==unescape(t[2]))return void showNoticeBtn();initNoticeModal(),document.cookie="notice_md5="+escape(e)}},error:function(){alert("错误：无法从服务器获取公告信息，请尝试刷新页面。")}})}function showNoticeBtn(){$("#shownoticebox").removeClass("hidden"),$("#shownoticebox").addClass("show")}function showNotice(){noticeInited?showNoticeModal():initNoticeModal()}function loadingRemainingFolderView(targetId){if(!remainingLoadingRequest){var newfoldersOffset=0,newfilesOffset=0;if(folderView.foldersOffset-folderView.selectStep>0&&(newfoldersOffset=folderView.foldersOffset-folderView.selectStep),folderView.filesOffset-folderView.selectStep>0&&(newfilesOffset=folderView.filesOffset-folderView.selectStep),newfoldersOffset<=0&&newfilesOffset<=0)return originFolderView=$.extend(!0,{},folderView),hiddenLoadingRemaininngBox(),void doFixedRow(targetId);var loadingRemainingRate_folders=1,loadingRemainingRate_files=1;totalFoldersOffset>0&&(loadingRemainingRate_folders=(totalFoldersOffset-newfoldersOffset)/totalFoldersOffset),totalFilesOffset>0&&(loadingRemainingRate_files=(totalFilesOffset-newfilesOffset)/totalFilesOffset);var loadingRemainingRate=(loadingRemainingRate_folders+loadingRemainingRate_files)/2;$("#loadingrate").text(parseInt(100*loadingRemainingRate)+"%"),remainingLoadingRequest=$.ajax({url:"homeController/getRemainingFolderView.ajax",data:{fid:locationpath,foldersOffset:newfoldersOffset,filesOffset:newfilesOffset},type:"POST",dataType:"text",success:function(result){switch(remainingLoadingRequest=null,result){case"ERROR":alert("错误：无法加载剩余文件列表，文件数据可能未显示完全，请刷新重试！"),hiddenLoadingRemaininngBox(),doFixedRow();break;case"NOT_FOUND":case"notAccess":document.cookie="folder_id="+escape("root");case"mustLogin":window.location.href="/";break;default:folderView.foldersOffset=newfoldersOffset,folderView.filesOffset=newfilesOffset;var remainingFV=eval("("+result+")");updateFolderTable(remainingFV),updateTheFolderInfo(),folderView.foldersOffset>0||folderView.filesOffset>0?loadingRemainingFolderView(targetId):(originFolderView=$.extend(!0,{},folderView),hiddenLoadingRemaininngBox(),doFixedRow(targetId))}},error:function(e,t,o){remainingLoadingRequest=null,hiddenLoadingRemaininngBox(),"abort"!=t&&alert("错误：无法连接服务器，文件列表加载被中断。请刷新重试！")}})}}function doFixedRow(e){e&&e.length>0&&($("#"+e).addClass("info"),$("html,body").animate({scrollTop:$("#"+e).offset().top-$(window).height()/2},"slow"))}function showLoadingRemaininngBox(){loadingComplete=!1,$("#loadingremaininngbox").addClass("show"),$("#loadingremaininngbox").removeClass("hidden"),$("#searchbtn").attr("disabled","disabled")}function hiddenLoadingRemaininngBox(){loadingComplete=!0,$("#loadingremaininngbox").removeClass("show"),$("#loadingremaininngbox").addClass("hidden"),$("#searchbtn").removeAttr("disabled")}function updateFolderTable(e){var t=folderView.authList,o=!1,l=!1,a=!1,r=!1;if(checkAuth(t,"D")&&(o=!0),checkAuth(t,"R")&&(l=!0),checkAuth(t,"L")&&(a=!0),checkAuth(t,"O")&&(r=!0),e.folderList&&e.folderList.length>0)for(var i=e.folderList.length;i>0;i--){var n=e.folderList[i-1];folderContains(folderView.folderList,n.folderId)||(folderView.folderList.unshift(n),$("[iskfolder=true]:last").after(createNewFolderRow(n,o,l,r)))}if(e.fileList&&e.fileList.length>0)for(var d=e.fileList.length;d>0;d--){var s=e.fileList[d-1];fileContains(folderView.fileList,s.fileId)||(folderView.fileList.unshift(s),$("#foldertable").append(createFileRow(s,a,o,l,r)))}}function folderContains(e,t){for(var o=e.length;o>0;o--)if(e[o-1].folderId==t)return!0;return!1}function fileContains(e,t){for(var o=e.length;o>0;o--)if(e[o-1].fileId==t)return!0;return!1}function updateTheFolderInfo(){$("#fim_statistics").text("共包含 "+folderView.folderList.length+" 个文件夹， "+folderView.fileList.length+" 个文件。")}function replaceAllQuotationMarks(e){return e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')}function html2Escape(e){return e.replace(/[<>&\']/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;","'":"&#39;"}[e]})}